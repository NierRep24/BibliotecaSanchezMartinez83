@model IEnumerable<BibliotecaDanielSanchez83.Models.Domain.Rol>

@{
    Layout = "_LayoutDashboard";
}

<div class="flex flex-col flex-1 p-6">
    <h1 class="text-blue-900 text-xl font-bold">Roles</h1>

    <div class="mt-4">
        <a asp-action="Crear" asp-controller="Rol" class="bg-blue-900 text-white px-4 py-2 rounded hover:bg-blue-600">
            <i class=""></i> Nuevo Rol
        </a>
    </div>

    <div class="mt-6 bg-white shadow-md rounded-lg p-4">
        <h1 class="text-lg font-semibold mb-4">Lista de Roles</h1>

        @if (Model.Any())
        {
            <div class="overflow-x-auto">
                <table id="tblRoles" class="w-full border border-gray-200 text-left">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="p-2 border">Nombre</th>
                            <th class="p-2 border">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var rol in Model)
                        {
                            <tr class="border hover:bg-gray-50">
                                <td class="p-2 border">@rol.Nombre</td>
                                <td class="p-2 border">
                                    <a class="text-green-500 hover:bg-green-50 hover:text-green-500 p-2 rounded-lg" asp-action="Editar" asp-route-id="@rol.PkRol">Editar</a>
                                    <a class="text-red-500 hover:bg-red-50 hover:text-red-500 p-2 rounded-lg eliminar-rol" data-id="@rol.PkRol">
                                        <i class="da-solid fa-trash"></i> Eliminar
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <p class="text-gray-500">No hay roles registrados.</p>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Configuración de DataTable
            $('#tblRoles').DataTable({
                language: {
                    "decimal": "",
                    "emptyTable": "No hay información",
                    "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
                    "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
                    "infoFiltered": "(Filtrado de _MAX_ total entradas)",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Mostrar _MENU_ Entradas",
                    "loadingRecords": "Cargando...",
                    "processing": "Procesando...",
                    "search": "Buscar:",
                    "zeroRecords": "Sin resultados encontrados",
                    "paginate": {
                        "first": "Primero",
                        "last": "Último",
                        "next": "Siguiente",
                        "previous": "Anterior"
                    }
                }
            });

            // Eliminar rol
            $('.eliminar-rol').on('click', function () {
                Swal.fire({
                    title: "¿Estás seguro de que deseas borrar este rol?",
                    text: "¡No podrás revertir esto!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Sí, deseo borrar!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        var rolId = $(this).data('id');

                        $.ajax({
                            url: '/Rol/Eliminar/' + rolId,
                            type: 'DELETE',
                            success: function (data) {
                                if (data.success) {
                                    location.reload();
                                }
                            }
                        });

                        Swal.fire({
                            title: "¡Eliminado!",
                            text: "El rol ha sido eliminado correctamente.",
                            icon: "success",
                            timer: 700
                        });
                    }
                });
            });
        });
    </script>
}
